<html>
<head>
	<meta charset="UTF-8">
	<title>Taurus Pilot</title>
	<script type="text/javascript" src="js/libs/jquery/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src="js/libs/three/three.js"></script>
	<script type="text/javascript" src="js/libs/three/keyboard.js"></script>
	<script type="text/javascript" src="js/libs/three/InputMapping.js"></script>
	<script type="text/javascript" src="js/libs/three/MTLLoader.js"></script>
	<script type="text/javascript" src="js/libs/three/OBJLoader.js"></script>
	<script type="text/javascript" src="js/libs/three/Game.js"></script>
	<script type="text/javascript" src="js/libs/three/Player.js"></script>
	<script type="text/javascript" src="js/libs/three/Background.js"></script>
	<script type="text/javascript" src="js/libs/three/Enemy.js"></script>
	<script type="text/javascript" src="js/libs/three/Asteroid.js"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="css/game.css" />
	<script type="text/javascript">
	var Jugador = new Game(1);
	var scoreold=0;
	var score=0;
	var timeleft = -5;
	var startGame = false;
	var downloadTimer = setInterval(function(){
	changeProgress(-100 + ++timeleft)
	if(timeleft == 1)
	{
		startGame = true;
		$("#progress").empty();
		Jugador.getVars(timeleft,startGame);
		//playSound();
	}
		score = Jugador.score;
		scoreold = score;
        console.log("score:" + score);
	if(timeleft >= 100)
		clearInterval(downloadTimer);
	},1195);//1195
	
	if(scoreold != score)
	{
		constructScore();
	}

	var keys = {};

	var isWorldReady = [ false ];
	$(document).ready(function() {
		Jugador._setupScene();
		Jugador.sceneStart();
		Jugador._Loop();
		$("#scene-section").append(Jugador.renderer.domElement);
	});
	
	function playSound() {
            var audio = document.getElementById('audioplayer');
            if (audio.paused) {
				audio.play();
            }else{
                audio.pause();
            }
		}
	
	function changeProgress(percent){
		var bgColor = "";
		if (percent >= -25)
		{
			bgColor = "red";
		}
		else if (percent >= -50)
		{
			bgColor = "orange";
		}
		else if (percent >= -75)
		{
			bgColor = "green";
		}
		else if (percent <= -100)
		{
			bgColor = "pink";
		}
		else
		{
			bgColor = "blue";
		}
		
		
	var progress=document.getElementById("progress");
	progress.style.backgroundPosition=percent+"%";
	progress.style.backgroundColor=bgColor;
	}
	</script>
</head>

<body>

	<div id="scene-section"/>
	<audio id="audioplayer" ><!-- autoplay--><!--猫又Call-->
		<source src="Resources/Call.mp3" type="audio/mpeg"/>
	</audio>
	<div id="OptionsModal" class="modalOption">
			<div class="modalOptionContent">
				<span class="closeOptions">&times;</span>
				<div class="wrapper2">
					<h3 id="element1">Habilitar Musica</h3>
					<label class="switch">  
					<input type="checkbox" checked="False" onclick="playSound()">
					<span  id="element3" class="slider round"></span>
					</label>
					<h3 id="element2">Habilitar Sonidos</h3>
					<label class="switch">  
					<input type="checkbox">
					<span  id="element3" class="slider round"></span>
					</label>
				</div>
			</div>
		</div>
		<div id="pauseButton">
				<button id="pause">Pausar</button>
				<div class="progress">
					<div id="progress" class="line stripesLoader" style="background-position:100%;
					background-color:blue">
					Loading..
					</div>
					<div id="text">
						<!-- content generated with JS -->  
					</div>
				  </div>
		</div>
		<script>
				// ModalOptions
				var modal = document.getElementById('OptionsModal');
		
				// Get the button that opens the modal
				var btn = document.getElementById("pause");
		
				// Get the <span> element that closes the modal
				var span = document.getElementsByClassName("closeOptions")[0];
		
				// When the user clicks on the button, open the modal 
				btn.onclick = function() {
					modal.style.display = "block";
				}
		
				// When the user clicks on <span> (x), close the modal
				span.onclick = function() {
					modal.style.display = "none";
				}
		
				// When the user clicks anywhere outside of the modal, close it
				window.onclick = function(event) {
					if (event.target == modal) {
						modal.style.display = "none";
					}
				}
				function constructScore(){
				// type anything here
					const text = 'score: ' + score;

				// this function turns a string into an array
				const createLetterArray = (string) => {
				return string.split('');
				}

				// this function creates letter layers wrapped in span tags
				const createLetterLayers = (array) => {
				return array.map((letter) => {
				let layer = '';
				//specify # of layers per letter
				for (let i = 1; i <= 2; i++) {
					// if letter is a space
					if(letter == ' '){
					layer += '<span class="space"></span>';
					}else{
					layer += '<span class="letter-'+i+'">'+letter+'</span>';
					}
				}
				return layer;
				});
				}

				// this function wraps each letter in a parent container
				const createLetterContainers = (array) => {
				return array.map((item) => {
					let container = '';
					container += '<div class="wrapper">'+item+'</div>';
					return container;
				});
				}

				// use a promise to output text layers into DOM first
				const outputLayers = new Promise(function(resolve, reject) {
					document.getElementById('text').innerHTML = createLetterContainers(createLetterLayers(createLetterArray(text))).join('');
					resolve();
				});

				// then adjust width and height of each letter
				const spans = Array.prototype.slice.call(document.getElementsByTagName('span'));
				outputLayers.then(() => {
					return spans.map((span) => {
					setTimeout(() => {
						span.parentElement.style.width = span.offsetWidth+'px';
						span.parentElement.style.height = span.offsetHeight+'px';
					}, 200);
					});  
				}).then(() => {
					// then slide letters into view one at a time
					let time = 3800;
					return spans.map((span) => {
					time += 75;
					setTimeout(() => {
						span.parentElement.style.top = '0px';
					}, time);
					});
				});
			}
			</script>
</body>
</html>